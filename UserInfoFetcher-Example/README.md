# Bandyer SDK User Info Fetcher Example

This sample app is going to show you how the Bandyer SDK should be configured, initialized, and how you can interact with it.

This example is only related to explain the usage of [BDKUserInfoFetcher](https://docs.bandyer.com/Bandyer-iOS-SDK/BandyerSDK/Protocols/BDKUserInfoFetcher.html) protocol. For other examples, please visit the [Sample apps index page](https://github.com/Bandyer/Bandyer-iOS-SDK-Samples).

## Quickstart

1. Obtain a Mobile API key.
2. Install [CocoaPods](https://guides.cocoapods.org/using/getting-started.html#getting-started) .
3. In terminal, `cd` to the sample project directory you are interested in and type `pod install`.
4. Open the project in Xcode using the `.xcworkspace` file just created.
5. Replace "PUT YOUR APP ID HERE" placeholder inside `AppDelegate` class with the app id provided. 
6. Replace the app bundle identifier and set up code signing if you want to run the example on a real device.

## Caveats

This app uses fake users fetched from our backend system. We provide access to those user through a REST api which requires another set of access keys. Once obtained, replace "REST API KEY" and "REST URL" placeholders inside `UserRepository` class.

If your backend system already provides Bandyer "user alias" for your users, then you should modify the app in order to fetch users information from you backend system instead of ours.

## Usage

In this demo app, all the integration work is already done for you. In this section we will explain how to take advantage of the feature provided by Bandyer SDK in another app.

We will skipp all the arguments not related to the main topic, such the SDK Start phase, the `CallWindow` and the `ChannelViewController` setup. 

### Setup

Before we dive into the details of how the BDKUserInfoFetcher works, you should add `NSCameraUsageDescription` and `NSMicrophoneUsageDescription` keys into app Info.plist, otherwise your app is going to crash anytime it tries to access camera or microphone devices.

To let you build on physical devices, you should set *No* to  *Enable Bitcode* on **Build Settings** tab under **Build Options** section of your target settings.

### BDKUserInfoFetcher

The `BDKUserInfoFetcher` protocol is intended to let Bandyer SDK know about your users information like name, surname, etc. Our SDK has not the capability of store this information, so is your responsability of providing them. 
Using the protocol, you can decide also the formatting style of those information.

In the demo app you can find four implementation of the protocol (`CallUserInfoFetcher`, `ChatUserInfoFetcher`, `GlobalUserInfoFetcher` and `NotificationUserInfoFetcher`), one for each possible configuration scenario.

Our SDK has already a default implementation of the protocol, the one that uses only the user id and display it on the screen. ***We strongly suggest you to implement your own info fetcher class***. Each time you pass to our SDK a class implementing the protocol, you are overriding the default behaviour, following this rules:

- The Global User Info Fetcher overrides the default behaviour.
- The Call User Info Fetcher overrides the Global User Info Fetcher, if set, otherwise overrides the default behaviour.
- The Chat User Info Fetcher overrides the Global User Info Fetcher, if set, otherwise overrides the default behaviour.
- The Notification User Info Fetcher overrides the Global User Info Fetcher, if set, otherwise overrides the default behaviour.


### Global User Info Fetcher

In this code snippet, we pass to the [BDKConfig](https://docs.bandyer.com/Bandyer-iOS-SDK/BandyerSDK/Classes/BDKConfig.html) class the instance of our User Info Fetcher. This is the global fetcher that will override the default one.

```objective-c
//Here we are going to initialize the Bandyer SDK.
//The sdk needs a configuration object where it is specified which environment the sdk should work in.
BDKConfig *config = [BDKConfig new];
    
//Here we are telling the SDK we want to work in a sandbox environment.
//Beware the default environment is production, we strongly recommend to test your app in a sandbox environment.
config.environment = BDKEnvironment.sandbox;

//Here we are disabling CallKit support.
//Make sure to disable CallKit, otherwise it will be enable by default if the system supports CallKit (i.e iOS >= 10.0).
config.callKitEnabled = NO;
    
//Here we are overriding the default user info fetcher with a global one.
//Somewhere in the code we will pass to that instance the AddressBook generated by the userAliases belonging to a company of our own.
config.userInfoFetcher = [GlobalUserInfoFetcher new];

//Now we are ready to initialize the SDK providing the app id token identifying your app in Bandyer platform.
[BandyerSDK.instance initializeWithApplicationId:@"PUT YOUR APP ID HERE" config:config];
```

### Call User Info Fetcher

When you want to start a new call, you need to configure the CallWindow instance with a [BDKCallViewControllerConfiguration](https://docs.bandyer.com/Bandyer-iOS-SDK/BandyerSDK/Classes/BDKCallViewControllerConfiguration.html), passing to it your implementation of [BDKUserInfoFetcher](https://docs.bandyer.com/Bandyer-iOS-SDK/BandyerSDK/Protocols/BDKUserInfoFetcher.html) protocol. This protocol is intended to manage your custom formatting of an user instance. The CallViewController will use this fetcher to properly present contact information in its views.

```objective-c
//Here we are configuring the BDKCallWindow instance
//A `BDKCallViewControllerConfiguration` object instance is needed to customize the behaviour and appearance of the view controller.
BDKCallViewControllerConfiguration *config = [[BDKCallViewControllerConfiguration alloc] init];

//This url points to a sample mp4 video in the app bundle used only if the application is run in the simulator.
NSURL *url = [NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@"SampleVideo_640x360_10mb" ofType:@"mp4"]];
config.fakeCapturerFileURL = url;

//This statement tells the view controller which object, conforming to `BDKUserInfoFetcher` protocol, should use to present contact
//information in its views.
//The backend system does not send any user information to its clients, the SDK and the backend system identify the users in a call
//using their user aliases, it is your responsibility to match "user aliases" with the corresponding user object in your system
//and provide those information to the view controller
config.userInfoFetcher = [[CallUserInfoFetcher alloc] initWithAddressBook:self.addressBook];

//Here, we set the configuration object created. You must set the view controller configuration object before the view controller
//view is loaded, otherwise an exception is thrown.
//If a call is already ongoing, the new configuration is skipped.
[self.callWindow setConfiguration:config];
```

### Chat User Info Fetcher

When you want to start a new chat session, you need to configure the ChannelViewController instance with a [ChannelViewControllerConfiguration](https://docs.bandyer.com/Bandyer-iOS-SDK/BandyerSDK/Classes/ChannelViewControllerConfiguration.html), passing to it your implementation of [BDKUserInfoFetcher](https://docs.bandyer.com/Bandyer-iOS-SDK/BandyerSDK/Protocols/BDKUserInfoFetcher.html) protocol. This protocol is intended to manage your custom formatting of an user instance. The ChannelViewController will use this fetcher to properly present contact information in its views.

```objective-c
BCHChannelViewController *channelViewController = [[BCHChannelViewController alloc] init];
channelViewController.delegate = self;
    
//Here we are configuring the channel view controller:
// if audioButton is true, the channel view controller will show audio button on nav bar;
// if videoButton is true, the channel view controller will show video button on nav bar;
// if userInfoFetcher is set, the global userInfoFetcher will be overridden. WARNING!!!
ChatUserInfoFetcher* chatUserInfoFetcher = [[ChatUserInfoFetcher alloc] initWithAddressBook:self.addressBook];

//Here if we pass a nil userInfoFetcher, the Bandyer SDK will use the global one if set at initialization time, otherwise a default one. The same result is achieved without setting the configuration property.
BCHChannelViewControllerConfiguration* configuration = [[BCHChannelViewControllerConfiguration alloc] initWithAudioButton:YES videoButton:YES userInfoFetcher:chatUserInfoFetcher];
    
//Otherwise you can use other initializer.
//BCHChannelViewControllerConfiguration* configuration = [[BCHChannelViewControllerConfiguration alloc] init]; //Equivalent to BCHChannelViewControllerConfiguration* configuration = [[BCHChannelViewControllerConfiguration alloc] initWithAudioButton:NO videoButton:NO userInfoFetcher:nil];
   
//If no configuration is provided, the default one will be used, the one with nil user info fetcher and showing both of the buttons -> ChannelViewControllerConfiguration(audioButton: true, videoButton: true, userInfoFetcher: nil)
channelViewController.configuration = configuration;
```

### Notification User Info Fetcher

Also the `MessageNotificationView` has got his own user info fetcher. The behaviour is the same as the previous fetchers.

```objective-c
//WARNING!!! If userInfoFetcher is set, the global userInfoFetcher will be overridden.
NotificationUserInfoFetcher* userInfoFetcher = [[NotificationUserInfoFetcher alloc] initWithAddressBook:self.addressBook];

//Here if we pass a nil userInfoFetcher, the Bandyer SDK will use the global one if set at initialization time, otherwise a default one. The same result is achieved without setting the configuration property.
BCHMessageNotificationControllerConfiguration* configuration = [[BCHMessageNotificationControllerConfiguration alloc] initWithUserInfoFetcher:userInfoFetcher];
self.messageNotificationController.configuration = configuration;
    
self.messageNotificationController.delegate = self;
self.messageNotificationController.parentViewController = self;
```

## Support

From here, please have a look to [Bandyer SDK Wiki](https://github.com/Bandyer/Bandyer-iOS-SDK/wiki). You will easily find guides to all the Bandyer world! 

To get basic support please submit an Issue. We will help you as soon as possible.

If you prefer commercial support, please contact bandyer.com sending an email at: [info@bandyer.com](mailto:info@bandyer.com).

## Credits

- Sample video file taken from [Sample Videos](https://sample-videos.com/).
- Sample user profile images taken from [RANDOM USER GENERATOR](https://randomuser.me/).
- Icons are part of the [Feather icon set](https://www.iconfinder.com/iconsets/feather-2) by [Cole Bemis](https://www.iconfinder.com/colebemis) distributed under [Creative Commons Attribution 3.0 Unported License](https://creativecommons.org/licenses/by/3.0/) downloaded from [Iconfinder](https://www.iconfinder.com/) website.

## License

Using this software, you agree to our license. For more details, see [LICENSE](https://github.com/Bandyer/Bandyer-iOS-SDK-Samples/blob/master/LICENSE) file.